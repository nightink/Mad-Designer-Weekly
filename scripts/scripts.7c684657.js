"use strict";angular.module("app",["ngAnimate","ngAria","ngCookies","ngSanitize","ngMaterial","ngClipboard"]).config(["ngClipProvider",function(a){a.setPath("fonts/ZeroClipboard.swf")}]).controller("MainCtrl",["$scope","$mdToast","Week","Thought",function(a,b,c,d){function e(b){return"thisWeek"===b?a.thisWeek:"nextWeek"===b?a.nextWeek:void 0}a.thisWeek=new c({el:document.getElementById("thisWeek"),title:"个人参与项目",cols:[{text:"工作任务"},{text:"参与人",width:200},{text:"工作完成进度",width:150},{text:"耗时",width:150}]}),a.nextWeek=new c({el:document.getElementById("nextWeek"),title:"下周计划",cols:[{text:"工作任务"},{text:"预计时间"}]}),a.thoughts=new d({title:"感想",content:""}),a.keyboard={buffer:[],detectCombination:function(){var a={};return this.buffer.forEach(function(b){a["key_"+b]=1}),(a.key_91||a.key_93)&&a.key_8?"command + delete":void 0},keydown:function(a,b,c,d){var f=a.keyCode;if(13==f)e(b).addRow(c);else if(f>36&&41>f)switch(f){case 37:e(b).leftCell(c,d);break;case 38:e(b).upCell(c,d);break;case 39:e(b).rightCell(c,d);break;case 40:e(b).downCell(c,d)}else this.buffer.push(f),"command + delete"===this.detectCombination()&&e(b).delRow(c)},keyup:function(){this.buffer=[]}},a.generate=function(){return b.show(b.simple().content("Markdown 已复制至剪切板!").position("top right").hideDelay(1500)),a.markdown=a.thisWeek.toMarkdown()+" \n\n "+a.nextWeek.toMarkdown()+" \n\n "+a.thoughts.toMarkdown(),a.markdown}}]),angular.module("app").factory("Week",["$timeout",function(a){function b(a){this.el=angular.element(a.el),this.title=a.title,this.cols=a.cols,this.rows=a.rows||[{}]}return b.prototype.addRow=function(a){return this.rows.splice(a+1,0,{}),this.focusRow(a+1),this},b.prototype.delRow=function(a){return 1!==this.rows.length?(this.rows.splice(a,1),this.focusRow(a-1>-1?a-1:0),this):void 0},b.prototype.focusRow=function(b,c){var d=this;return c=c||0,a(function(){d.el.find("tbody").find("tr").eq(b).find("input").eq(c).focus()},0),d},b.prototype.leftCell=function(a,b){if(0===b){if(0===a)return;a--,b=this.cols.length-1}else b--;return this.focusRow(a,b)},b.prototype.rightCell=function(a,b){if(b===this.cols.length-1){if(a===this.rows.length-1)return;a++,b=0}else b++;return this.focusRow(a,b)},b.prototype.upCell=function(a,b){return 0!==a?(a--,this.focusRow(a,b)):void 0},b.prototype.downCell=function(a,b){return a!==this.rows.length-1?(a++,this.focusRow(a,b)):void 0},b.prototype.toMarkdown=function(){var a=this.markdown=" ";a+="### ",a+=this.title,a+=" \n\n ",a+=" | ",this.cols.forEach(function(b){a+=b.text,a+=" | "}),a+=" \n ",a+=" | ",this.cols.forEach(function(){a+="------",a+=" | "});var b=[];return angular.copy(this.rows).forEach(function(c){b=[];for(var d in c)c.hasOwnProperty(d)&&(b[d.charAt(d.length-1)]=c[d]);a+=" \n ",a+=" | ",b.forEach(function(b){a+=b,a+=" | "})}),a},b}]),angular.module("app").factory("Thought",function(){function a(a){this.title=a.title||"Thoughts",this.content=a.content}return a.prototype.toMarkdown=function(){var a=this.markdown=" ";return a+="### ",a+=this.title,a+=" \n\n  ",a+=this.content},a});